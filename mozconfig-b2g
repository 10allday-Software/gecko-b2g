# Compiler
export CC=$HOME/.mozbuild/clang/bin/clang
export CXX=$HOME/.mozbuild/clang/bin/clang++
export LLVMCONFIG=$HOME/.mozbuild/clang/bin/llvm-config
export LLVM_CONFIG=$HOME/.mozbuild/clang/bin/llvm-config
export AR=$HOME/.mozbuild/clang/bin/llvm-ar
export NM=$HOME/.mozbuild/clang/bin/llvm-nm
export RANLIB=$HOME/.mozbuild/clang/bin/llvm-ranlib
#export CBINDGEN=$HOME/.mozbuild/cbindgen/cbindgen

# Build B2G
ac_add_options --enable-application=b2g
ac_add_options --target=arm-linux-androideabi
ac_add_options --enable-linker=lld

# Disable a bunch of non critical stuff
ac_add_options --disable-crashreporter
ac_add_options --disable-webrtc
ac_add_options --disable-printing
ac_add_options --disable-updater
ac_add_options --disable-cranelift
# Disable telemetry
ac_add_options MOZ_TELEMETRY_REPORTING=

if [ "${B2G_DEBUG:-0}" != "0" ]; then
  ac_add_options --enable-debug
else
  if [ "${DISABLE_LTO:-0}" = "0" ]; then
    # Enable Rust <-> C++ LTO
    ac_add_options --enable-lto
    export MOZ_LTO=cross
  fi
fi

# Optimize the build
ac_add_options --disable-profiling
ac_add_options --enable-small-chunk-size

# With the following Android SDK and NDK:
ac_add_options --with-android-ndk=$ANDROID_NDK
ac_add_options --with-android-version=$PLATFORM_VERSION

# Use sccache
ac_add_options --with-ccache=sccache

# Auto-clobber
mk_add_options AUTOCLOBBER=1

# Gonk-specific stuff
ac_add_options --with-gonk-gfx
ac_add_options --with-gonk="$GONK_PATH"

# Customize the objdir.
if [ -f "$GECKO_OBJDIR" ]; then
mk_add_options MOZ_OBJDIR="$GECKO_OBJDIR"
fi

# Pretend to be an official build to be in a release configuration.
export MOZILLA_OFFICIAL=1
# elf hack fails with a "Segments overlap" error.
ac_add_options --disable-elf-hack

ac_add_options --enable-b2g-camera

ac_add_options --with-gnss1.0-so="$SYS_LIB/android.hardware.gnss@1.0.so"
if [ $PLATFORM_VERSION -ge 29 ]; then
  ac_add_options --with-gnss1.1-so="$SYS_LIB/android.hardware.gnss@1.1.so"
  ac_add_options --with-gnss2.0-so="$SYS_LIB/android.hardware.gnss@2.0.so"
fi

ac_add_options --with-dnsresolver-so="$SYS_LIB/dnsresolver_aidl_interface-V2-cpp.so"
ac_add_options --with-netd-event-so="$SYS_LIB/netd_aidl_interface-V2-cpp.so"
ac_add_options --with-netd-aidl-so="$SYS_LIB/netd_event_listener_interface-V1-cpp.so"
ac_add_options --with-radio-so="$SYS_LIB/android.hardware.radio@1.0.so"
ac_add_options --with-vibrator-so="$SYS_LIB/android.hardware.vibrator@1.0.so"
